(this["webpackJsonpmasks-map"]=this["webpackJsonpmasks-map"]||[]).push([[0],{176:function(e,t,a){e.exports=a(370)},181:function(e,t,a){},370:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(3),s=a.n(c),i=a(39),o=(a(181),a(111)),l=a(165);var u=a(57),m=a(160),d=a(22),p=a(376),E={list:[],errorCode:0,errorText:""},f={list:[],errorCode:0,errorText:""},h={distance:{info:1,text:"\u4e00\u516c\u91cc"},mask:{info:"",text:"\u53e3\u7f69\u7a2e\u985e"}},y=Object(u.b)({location:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_USER_LOCATION":return Object(d.a)({},e,{list:t.list});case"RECEIVE_USER_LOCATION_ERROR":return Object(d.a)({},e,{errorCode:t.errorCode,errorText:p.a.error({message:"\u53d6\u5f97\u4f4d\u7f6e\u8cc7\u6599\u5931\u6557",description:t.errorText})});default:return e}},shopes:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_SHOPES":return Object(d.a)({},e,{list:t.list});case"RECEIVE_SHOPES_ERROR":return Object(d.a)({},e,{errorCode:t.errorCode,errorText:p.a.error({message:"\u53d6\u5f97\u5e97\u5bb6\u8cc7\u6599\u5931\u6557",description:t.errorText})});default:return e}},selectedOption:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVE_SELECTED_DISTANCE":return Object(d.a)({},e,{distance:{info:t.info,text:t.text}});case"RECEIVE_SELECTED_MASK_TYPE":return Object(d.a)({},e,{mask:{info:t.info,text:t.text}});default:return e}}}),g=Object(u.c)(y,Object(u.a)(m.a)),v=function(){return function(){return new Promise((function(e,t){navigator.geolocation.watchPosition((function(t){e({lat:t.coords.latitude,lng:t.coords.longitude})}))})).then((function(e){e&&g.dispatch(function(e){return{type:"RECEIVE_USER_LOCATION",list:e}}(e))}))}},b=a(164),k=a.n(b),N=function(){return k.a.get("https://raw.githubusercontent.com/kiang/pharmacies/master/json/points.json").then((function(e){return e.data.features}))},x=a(374),O=a(110),I=a(80),C=a(6),S=a(50),T=a(77),j=function(){function e(){Object(S.a)(this,e)}return Object(T.a)(e,null,[{key:"calculateDistance",value:function(e,t){var a=e.lat,n=e.lng,r=t[1],c=t[0],s=a*(Math.PI/180),i=r*(Math.PI/180),o=(r-a)*(Math.PI/180),l=(c-n)*(Math.PI/180),u=Math.sin(o/2)*Math.sin(o/2)+Math.cos(s)*Math.cos(i)*(Math.sin(l/2)*Math.sin(l/2)),m=6371e3*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)));return Math.round(m)}},{key:"generateNearbyShop",value:function(e,t,a){for(var n=[],r=0;r<t.length;r++)this.calculateDistance(e,t[r].geometry.coordinates)<=a&&n.push(t[r]);return n}}]),e}(),w=function e(){Object(S.a)(this,e)};w.distance=[{type:"distance",info:1,text:"\u4e00\u516c\u91cc"},{type:"distance",info:5,text:"\u4e94\u516c\u91cc"},{type:"distance",info:10,text:"\u5341\u516c\u91cc"}],w.mask=[{type:"mask",info:"all",text:"\u5168\u90e8"},{type:"mask",info:"adult",text:"\u6210\u4eba\u53e3\u7f69"},{type:"mask",info:"child",text:"\u5152\u7ae5\u53e3\u7f69"}];var _=w;function R(e){var t=e.mapApi,a=e.map,c=null;Object(n.useEffect)((function(){(a||t)&&((c=new t.places.SearchBox(s.searchInput)).addListener("places_changed",i),c.bindTo("bounds",a))}));var s={};function i(){var t=c.getPlaces(),n=t[0];n.geometry&&(n.geometry.viewport?a.fitBounds(n.geometry.viewport):(a.setCenter(n.geometry.location),a.setZoom(17)),e.addPlace(t))}return r.a.createElement("input",{ref:function(e){s.searchInput=e},type:"text",onFocus:function(){s.searchInput.value=""},placeholder:"\u6211\u7684\u4f4d\u7f6e",className:"google-search-input-style"})}var L=a(373),M=function(){function e(){Object(S.a)(this,e)}return Object(T.a)(e,null,[{key:"gererateBusinessHours",value:function(e){return e.split("\u3001")}},{key:"gererateTimeTable",value:function(e,t,a){var n={sunday:"",monday:"",tuesday:"",wednesday:"",thursday:"",friday:"",saturday:""};return e.forEach((function(e){switch(e){case"\u661f\u671f\u65e5".concat(t,"\u770b\u8a3a"):n.sunday=a;break;case"\u661f\u671f\u4e00".concat(t,"\u770b\u8a3a"):n.monday=a;break;case"\u661f\u671f\u4e8c".concat(t,"\u770b\u8a3a"):n.tuesday=a;break;case"\u661f\u671f\u4e09".concat(t,"\u770b\u8a3a"):n.wednesday=a;break;case"\u661f\u671f\u56db".concat(t,"\u770b\u8a3a"):n.thursday=a;break;case"\u661f\u671f\u4e94".concat(t,"\u770b\u8a3a"):n.friday=a;break;case"\u661f\u671f\u516d".concat(t,"\u770b\u8a3a"):n.saturday=a}})),n}}]),e}(),A=a(375),P=L.a.Column;function D(e){var t=M.gererateBusinessHours(e.timeList),a=[],n=[],c=[];t.forEach((function(e){e.search("\u4e0a\u5348")>0&&a.push(e),e.search("\u4e0b\u5348")>0&&n.push(e),e.search("\u665a\u4e0a")>0&&c.push(e)}));var s=r.a.createElement(A.a,{twoToneColor:"#78D5D7"}),i=M.gererateTimeTable(a,"\u4e0a\u5348",s),o=M.gererateTimeTable(n,"\u4e0b\u5348",s),l=M.gererateTimeTable(c,"\u665a\u4e0a",s),u=[Object(d.a)({key:"1",time:"\u65e9"},i),Object(d.a)({key:"2",time:"\u4e2d"},o),Object(d.a)({key:"3",time:"\u665a"},l)];return r.a.createElement(L.a,{dataSource:u,pagination:!1,bordered:!0},r.a.createElement(P,{title:"",dataIndex:"time",key:"time",align:"center"}),r.a.createElement(P,{title:"\u65e5",dataIndex:"sunday",key:"sunday",align:"center"}),r.a.createElement(P,{title:"\u4e00",dataIndex:"monday",key:"monday",align:"center"}),r.a.createElement(P,{title:"\u4e8c",dataIndex:"tuesday",key:"tuesday",align:"center"}),r.a.createElement(P,{title:"\u4e09",dataIndex:"wednesday",key:"wednesday",align:"center"}),r.a.createElement(P,{title:"\u56db",dataIndex:"thursday",key:"thursday",align:"center"}),r.a.createElement(P,{title:"\u4e94",dataIndex:"friday",key:"friday",align:"center"}),r.a.createElement(P,{title:"\u516d",dataIndex:"saturday",key:"saturday",align:"center"}))}var V=x.a.Search;function H(e){var t=Object(i.b)(),a=function(e){var a=e.domEvent.currentTarget.getAttribute("data-type"),n=e.domEvent.currentTarget.getAttribute("data-info"),r=e.domEvent.currentTarget.getAttribute("data-text");if("distance"===a){var c={text:r,info:parseInt(n)};t(function(e){return g.dispatch(function(e){return{type:"RECEIVE_SELECTED_DISTANCE",text:e.text,info:e.info}}(e))}(c))}"mask"===a&&t(function(e){return g.dispatch(function(e){return{type:"RECEIVE_SELECTED_MASK_TYPE",text:e.text,info:e.info}}(e))}({text:r,info:n}))};function n(e){var t=e.map((function(e,t){return r.a.createElement(O.a.Item,{key:t,onClick:a,"data-type":e.type,"data-info":e.info,"data-text":e.text},e.text)}));return r.a.createElement(O.a,null,t)}var c=0===Object.keys(e.maps).length,s=j.generateNearbyShop(e.currentLocation,e.filterShopes(),e.currentDistance);return r.a.createElement("div",{className:"side-search"},r.a.createElement("div",{className:"filter-type"},r.a.createElement("div",{className:"search-main"},c?null:r.a.createElement(R,{map:e.maps.mapInstance,mapApi:e.maps.mapApi,addPlace:e.addPlace}),r.a.createElement(V,{onSearch:function(e){return console.log(e)},style:{width:200},className:"search-main-style"})),r.a.createElement(I.a,{overlay:n(_.distance),trigger:["click"],className:"select-main-style"},r.a.createElement("button",{className:"ant-dropdown-link",href:"#"},e.distance.text,r.a.createElement(C.a,{type:"caret-down"}))),r.a.createElement(I.a,{overlay:n(_.mask),trigger:["click"],className:"select-main-style"},r.a.createElement("button",{className:"ant-dropdown-link",href:"#"},e.mask.text,r.a.createElement(C.a,{type:"caret-down"})))),r.a.createElement("ul",{className:"shop-info"},0===s.length?r.a.createElement("p",null,"\u9644\u8fd1\u7121\u85e5\u5c40"):s.map((function(t){return r.a.createElement("li",{key:t.properties.id},r.a.createElement("span",{className:"distance"},j.calculateDistance(e.currentLocation,t.geometry.coordinates),"\u516c\u5c3a"),r.a.createElement("p",{className:"title"},t.properties.name),r.a.createElement("span",{className:"address"},t.properties.address),r.a.createElement("span",{className:"phone"},t.properties.phone),r.a.createElement("div",{className:"note"},t.properties.note),r.a.createElement("div",{className:"business-hours"},r.a.createElement(D,{timeList:t.properties.available})),r.a.createElement("div",{className:"quantity-display"},r.a.createElement("div",{className:"adult"},"\u6210\u4eba\u53e3\u7f69 ",r.a.createElement("strong",null,t.properties.mask_adult)),r.a.createElement("div",{className:"child"},"\u5152\u7ae5\u53e3\u7f69 ",r.a.createElement("strong",null,t.properties.mask_child))),r.a.createElement("div",{className:"update-time"},"\u66f4\u65b0\u6642\u9593 ",t.properties.updated))}))))}var B=a(173),U=a.n(B);function G(e){var t=e.place.show,a=e.place.properties.note;return r.a.createElement(r.a.Fragment,null,t?r.a.createElement("div",{className:"info-window clear-fix"},r.a.createElement("div",{className:"col text"},r.a.createElement("h3",{className:"name"},e.place.properties.name),r.a.createElement("p",{className:"address"},e.place.properties.address),r.a.createElement("p",{className:"address"},e.place.properties.phone),r.a.createElement("div",{className:"mask-type"},r.a.createElement("div",{className:"adult"},r.a.createElement("b",null,"\u6210\u4eba\u53e3\u7f69"),e.place.properties.mask_adult),r.a.createElement("div",{className:"child"},r.a.createElement("b",null,"\u5152\u7ae5\u53e3\u7f69"),e.place.properties.mask_child)),r.a.createElement("div",{className:"updated"},r.a.createElement("span",null,"\u66f4\u65b0\u6642\u9593"),e.place.properties.updated),r.a.createElement("div",{className:"note"},a)),r.a.createElement("div",{className:"col available"},r.a.createElement(D,{timeList:e.place.properties.available}))):null)}function K(e){return r.a.createElement("div",{className:"map-marker"},r.a.createElement("div",{className:"pin bounce"}),r.a.createElement("div",{className:"pulse"}),r.a.createElement(G,{place:e.place}))}function q(e){var t=j.generateNearbyShop(e.currentLocation,e.filterShopes(),e.currentDistance);return r.a.createElement("div",{className:"main-map"},r.a.createElement(U.a,{bootstrapURLKeys:{key:"".concat("AIzaSyCMKwChei7MoIt1hgOtLL-tB4wARN1eSHA"),libraries:["places","geometry"]},defaultCenter:e.originLocation,defaultZoom:15,yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:function(t){var a=t.map,n=t.maps;e.setGoogleMaps(a,n)},onChildClick:function(t){var a=e.shopes.findIndex((function(e){return e.properties.id===t}));e.shopes[a].show=!e.shopes[a].show}},t.map((function(e){return r.a.createElement(K,{key:e.properties.id,lat:e.geometry.coordinates[1],lng:e.geometry.coordinates[0],place:e})}))))}function F(){var e=Object(n.useState)({}),t=Object(o.a)(e,2),a=t[0],c=t[1];var s=Object(n.useCallback)((function(e){return{location:e.location.list,shopes:e.shopes.list,distance:e.selectedOption.distance,mask:e.selectedOption.mask}}),[]),u=Object(i.c)(s),m=u.location,d=u.shopes,p=u.distance,E=u.mask,f=Object(i.b)();Object(n.useEffect)((function(){f(v()),f((function(){return N().then((function(e){e&&(e.forEach((function(e){return e.show=!1})),g.dispatch(function(e){return{type:"RECEIVE_SHOPES",list:e}}(e)))})).catch((function(e){var t,a;g.dispatch((t=e.response.status,a=e.response.statusText,{type:"RECEIVE_SHOPES_ERROR",errorCode:t,errorText:a}))}))}))}),[]);var h=Object(n.useState)({lat:0,lng:0}),y=Object(o.a)(h,2),b=y[0],k=y[1];var x=0===m.length||0===d.length,O={lat:m.lat,lng:m.lng},I=0===b.lat?O:b,C=0===p.info?1e3:1e3*p.info;function S(){return"child"===E.info?d.filter((function(e){return e.properties.mask_child>0})):"adult"===E.info?d.filter((function(e){return e.properties.mask_adult>0})):d}return r.a.createElement("div",{className:"container"},x?r.a.createElement(l.a,{size:"large"}):r.a.createElement(r.a.Fragment,null,r.a.createElement(H,{maps:a,mask:E,shopes:d,distance:p,location:m,addPlace:function(e){k({lat:e[0].geometry.location.lat(),lng:e[0].geometry.location.lng()})},currentLocation:I,currentDistance:C,filterShopes:S}),r.a.createElement(q,{setGoogleMaps:function(e,t){c({mapInstance:e,mapApi:t})},shopes:j.generateNearbyShop(I,d,C),originLocation:O,currentLocation:I,currentDistance:C,filterShopes:S})))}s.a.render(r.a.createElement(i.a.Provider,{value:g},r.a.createElement((function(){return r.a.createElement("div",{className:"container"},r.a.createElement(F,null))}),null)),document.getElementById("root"))}},[[176,1,2]]]);
//# sourceMappingURL=main.d638179d.chunk.js.map